# Auto generated by Chef. Changes will be overwritten.

<VirtualHost *:<%= @params[:port] %>>
  ServerName <%= @params[:server_name] %>
  ServerAlias <% @params[:server_aliases].each do |a| %><%= "#{a}" %> <% end %>
  DocumentRoot <%= @params[:docroot] %>

  <Directory <%= @params[:docroot] %>>
    Options FollowSymLinks
    AllowOverride FileInfo Options
    AllowOverride All
    Order allow,deny
    Allow from all
   
    <% if @params[:passwd] %>
    AuthType Basic
    AuthName "Restricted Files"
    AuthBasicProvider file
    AuthUserFile /etc/apache2/passwds
    Require valid-user
    <% end %>
  </Directory>

  <Directorymatch "^/.*/\.git+/">
    Order deny,allow
    Deny from all
  </Directorymatch>
  <Files ~ "^\.git">
    Order allow,deny
    Deny from all 
  </Files>

  <Directory />
    Options FollowSymLinks
    AllowOverride None
  </Directory>

  <% unless @params[:url_redirects].empty? %>
  <% @params[:url_redirects].each do |src, dest| %>
  Redirect <%= src %> <%= dest %>
  <% end %>

  <% end %>
  LogLevel info
  ErrorLog <%= @params[:log_path] %>/error.log
  CustomLog <%= @params[:log_path] %>/access.log combined
</VirtualHost>
